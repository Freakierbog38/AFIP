<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;

class ResultadosController extends Controller
{

    public function index(){

        ////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////// Datos de Mezcla de Productos y Servicios //////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////
        $tablaMezclaProSer = DB::select('CALL II_pro_select_productos_servicios_id(?)', array( \Auth::user()->id_usuario ) );

        $tablaTotalMezclaProSer = DB::select('CALL II_pro_get_suma_valores_mezcla_productos_servicios_1_anio(?)', array( \Auth::user()->id_usuario ) );

        ////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////// Capacidad Instalada de la Empresa ///////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////
        $tablaCapInstalada2 = DB::select('CALL IV_pro_select_capacidad_instalada_id(?)', array( \Auth::user()->id_usuario ) );

        $tablaCapInstalada = DB::select('CALL IV_pro_get_produccion_actual(?)', array( \Auth::user()->id_usuario ) );

        ////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////// Capacidad Instalada de la Empresa ///////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////
        $tablaEstacionVentas = DB::select('CALL II_pro_select_estacionalidad_ventas_id(?)', array( \Auth::user()->id_usuario ) );

        ////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////// Balance General /////////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////
        $tablaBalanceGral = DB::select('CALL get_balance_reporte(?)', array( \Auth::user()->id_usuario ) );
        
        ////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////// Resultado HistÃ³rico /////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////
        $tablaResultHist = DB::select('CALL VI_pro_select_cifras_id(?)', array( \Auth::user()->id_usuario ) );

        ////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////// Fuentes Financiamiento del Proyecto ////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////
        $tablaFinanProject = DB::select('CALL VIII_pro_select_fuente_financiamiento_id(?)', array( \Auth::user()->id_usuario ) );

        ////////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////// Destino Inversiones ///////////////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////////////////
        $tablaDestInver = DB::select('CALL VIII_pro_select_destino_inversiones_id(?)', array( \Auth::user()->id_usuario ) );

        return view('modulos.Resultados', 
            [
                'title'                     => 'Reporte AFIP',
                'tablaMezclaProSer'         => $tablaMezclaProSer,
                'tablaTotalMezclaProSer'    => $tablaTotalMezclaProSer,
                'tablaCapInstalada'         => $tablaCapInstalada,
                'tablaCapInstalada2'        => $tablaCapInstalada2,
                'tablaEstacionVentas'       => $tablaEstacionVentas,
                'tablaBalanceGral'          => $tablaBalanceGral,
                'tablaResultHist'           => $tablaResultHist,
                'tablaFinanProject'         => $tablaFinanProject,
                'tablaDestInver'            => $tablaDestInver,
            ]);
    }
}
